<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Introduction to TrajConserve â€¢ TrajConserve</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Roboto-0.4.9/font.css" rel="stylesheet">
<link href="../deps/Source_Code_Pro-0.4.9/font.css" rel="stylesheet">
<link href="../deps/Roboto_Slab-0.4.9/font.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Introduction to TrajConserve">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">TrajConserve</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item"><a class="nav-link" href="../articles/introduction.html">Introduction</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/conservation_analysis.html">Conservation Analysis with TrajConserve</a></li>
    <li><a class="dropdown-item" href="../articles/introduction.html">Introduction to TrajConserve</a></li>
    <li><a class="dropdown-item" href="../articles/stan_note.html">Note About Stan Dependencies</a></li>
    <li><a class="dropdown-item" href="../articles/workflow.html">TrajConserve Workflow</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/GilbertHan1011/TrajConserve" aria-label="GitHub"><span class="fa fab fa-github"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Introduction to TrajConserve</h1>
                        <h4 data-toc-skip class="author">Gilbert
Han</h4>
            
            <h4 data-toc-skip class="date">2025-03-31</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/GilbertHan1011/TrajConserve/blob/main/vignettes/introduction.Rmd" class="external-link"><code>vignettes/introduction.Rmd</code></a></small>
      <div class="d-none name"><code>introduction.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="trajconserve">TrajConserve<a class="anchor" aria-label="anchor" href="#trajconserve"></a>
</h2>
<div class="section level3">
<h3 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h3>
<p>TrajConserve is an R package designed for analyzing gene expression
trajectories and identifying conserved expression patterns across
experimental conditions. This package implements Bayesian generalized
additive models (GAMs) to model gene expression over pseudotime
trajectories and provides tools for quantifying conservation of
expression patterns.</p>
<p>The package is particularly useful for:</p>
<ul>
<li>Modeling expression dynamics along developmental or cell
differentiation trajectories</li>
<li>Identifying genes with conserved or divergent expression patterns
across conditions</li>
<li>Visualizing and comparing trajectory models</li>
<li>Storing and retrieving model results in HDF5 format</li>
</ul>
</div>
<div class="section level3">
<h3 id="features">Features<a class="anchor" aria-label="anchor" href="#features"></a>
</h3>
<ul>
<li>
<strong>Trajectory Modeling</strong>: Fit Bayesian GAMs to gene
expression data along pseudotime trajectories.</li>
<li>
<strong>Conservation Analysis</strong>: Quantify gene conservation
based on expression levels and variability.</li>
<li>
<strong>HDF5 Integration</strong>: Store and retrieve large model
results efficiently.</li>
<li>
<strong>Visualization Tools</strong>: Create publication-ready plots
of model results and conservation metrics.</li>
</ul>
</div>
<div class="section level3">
<h3 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h3>
<p>You can install TrajConserve from GitHub:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Install devtools if you haven't already</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/ns-load.html" class="external-link">requireNamespace</a></span><span class="op">(</span><span class="st">"devtools"</span>, quietly <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"devtools"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Install the package from GitHub</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span><span class="st">"username/TrajConserve"</span><span class="op">)</span></span></code></pre></div>
<div class="section level4">
<h4 id="dependencies">Dependencies<a class="anchor" aria-label="anchor" href="#dependencies"></a>
</h4>
<p>TrajConserve depends on several packages, including:</p>
<ul>
<li>
<strong>brms</strong>: For Bayesian regression modeling via
Stan</li>
<li>
<strong>rhdf5</strong>: For HDF5 file handling</li>
<li>
<strong>ggplot2</strong>: For visualization</li>
<li>
<strong>pheatmap</strong>: For creating heatmaps</li>
<li>
<strong>data.table</strong>: For efficient data manipulation</li>
</ul>
</div>
</div>
<div class="section level3">
<h3 id="basic-usage">Basic Usage<a class="anchor" aria-label="anchor" href="#basic-usage"></a>
</h3>
<div class="section level4">
<h4 id="converting-seurat-data-to-trajectory-array">1. Converting Seurat data to trajectory array<a class="anchor" aria-label="anchor" href="#converting-seurat-data-to-trajectory-array"></a>
</h4>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/GilbertHan1011/TrajConserve" class="external-link">TrajConserve</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://satijalab.org/seurat" class="external-link">Seurat</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Assuming 'seurat_obj' is your Seurat object with integrated data</span></span>
<span><span class="co"># and 'pseudotime' is a column in the metadata</span></span>
<span><span class="va">trajectory_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/seurat_to_trajectory_array.html">seurat_to_trajectory_array</a></span><span class="op">(</span></span>
<span>  seurat_obj <span class="op">=</span> <span class="va">seurat_obj</span>,</span>
<span>  assay <span class="op">=</span> <span class="st">"RNA"</span>,</span>
<span>  pseudotime_col <span class="op">=</span> <span class="st">"pseudotime"</span>,</span>
<span>  batch_col <span class="op">=</span> <span class="st">"sample_id"</span>,</span>
<span>  genes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Gene1"</span>, <span class="st">"Gene2"</span>, <span class="st">"Gene3"</span>, <span class="st">"Gene4"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="running-trajectory-models">2. Running trajectory models<a class="anchor" aria-label="anchor" href="#running-trajectory-models"></a>
</h4>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Run models for multiple genes</span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_multiple_models.html">run_multiple_models</a></span><span class="op">(</span></span>
<span>  data_array <span class="op">=</span> <span class="va">trajectory_data</span>,</span>
<span>  output_file <span class="op">=</span> <span class="st">"trajectory_models.h5"</span>,</span>
<span>  family <span class="op">=</span> <span class="st">"negbinomial"</span>,</span>
<span>  n_cores <span class="op">=</span> <span class="fl">4</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="analyzing-conservation-of-gene-expression">3. Analyzing conservation of gene expression<a class="anchor" aria-label="anchor" href="#analyzing-conservation-of-gene-expression"></a>
</h4>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Calculate conservation scores</span></span>
<span><span class="va">conservation_results</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/calculate_conservation.html">calculate_conservation</a></span><span class="op">(</span></span>
<span>  h5_file <span class="op">=</span> <span class="st">"trajectory_models.h5"</span>,</span>
<span>  metric <span class="op">=</span> <span class="st">"Estimate"</span>,</span>
<span>  mean_weight <span class="op">=</span> <span class="fl">0.6</span>,</span>
<span>  variability_weight <span class="op">=</span> <span class="fl">0.4</span>,</span>
<span>  conservation_threshold <span class="op">=</span> <span class="fl">0.7</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># View conservation results</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">conservation_results</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Visualize conservation metrics</span></span>
<span><span class="fu"><a href="../reference/plot_conservation.html">plot_conservation</a></span><span class="op">(</span><span class="va">conservation_results</span>, plot_type <span class="op">=</span> <span class="st">"scatter"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="extracting-and-visualizing-metrics-from-hdf5-files">4. Extracting and visualizing metrics from HDF5 files<a class="anchor" aria-label="anchor" href="#extracting-and-visualizing-metrics-from-hdf5-files"></a>
</h4>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Extract Estimate values</span></span>
<span><span class="va">estimates</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/extract_hdf5_metric.html">extract_hdf5_metric</a></span><span class="op">(</span><span class="st">"trajectory_models.h5"</span>, <span class="st">"Estimate"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create a heatmap</span></span>
<span><span class="fu"><a href="../reference/plot_hdf5_heatmap.html">plot_hdf5_heatmap</a></span><span class="op">(</span><span class="st">"trajectory_models.h5"</span>, <span class="st">"Estimate"</span>, scale <span class="op">=</span> <span class="st">"row"</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="example-workflow">Example Workflow<a class="anchor" aria-label="anchor" href="#example-workflow"></a>
</h3>
<p>Below is a complete workflow example from preprocessing data to
analyzing conservation:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/GilbertHan1011/TrajConserve" class="external-link">TrajConserve</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://satijalab.org/seurat" class="external-link">Seurat</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 1. Prepare data</span></span>
<span><span class="va">seurat_obj</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="st">"your_seurat_object.rds"</span><span class="op">)</span></span>
<span><span class="va">genes_of_interest</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Gene1"</span>, <span class="st">"Gene2"</span>, <span class="st">"Gene3"</span>, <span class="st">"Gene4"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 2. Convert Seurat data to trajectory array</span></span>
<span><span class="va">traj_array</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/seurat_to_trajectory_array.html">seurat_to_trajectory_array</a></span><span class="op">(</span></span>
<span>  seurat_obj <span class="op">=</span> <span class="va">seurat_obj</span>,</span>
<span>  assay <span class="op">=</span> <span class="st">"RNA"</span>,</span>
<span>  pseudotime_col <span class="op">=</span> <span class="st">"pseudotime"</span>,</span>
<span>  batch_col <span class="op">=</span> <span class="st">"condition"</span>,</span>
<span>  genes <span class="op">=</span> <span class="va">genes_of_interest</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 3. Run trajectory models</span></span>
<span><span class="va">output_file</span> <span class="op">&lt;-</span> <span class="st">"results/trajectory_models.h5"</span></span>
<span><span class="fu"><a href="../reference/run_multiple_models.html">run_multiple_models</a></span><span class="op">(</span></span>
<span>  data_array <span class="op">=</span> <span class="va">traj_array</span>,</span>
<span>  output_file <span class="op">=</span> <span class="va">output_file</span>,</span>
<span>  family <span class="op">=</span> <span class="st">"negbinomial"</span>,</span>
<span>  n_cores <span class="op">=</span> <span class="fl">4</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 4. Calculate conservation scores</span></span>
<span><span class="va">conservation_results</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/calculate_conservation.html">calculate_conservation</a></span><span class="op">(</span></span>
<span>  h5_file <span class="op">=</span> <span class="va">output_file</span>,</span>
<span>  metric <span class="op">=</span> <span class="st">"Estimate"</span>,</span>
<span>  mean_weight <span class="op">=</span> <span class="fl">0.6</span>,</span>
<span>  variability_weight <span class="op">=</span> <span class="fl">0.4</span>,</span>
<span>  conservation_threshold <span class="op">=</span> <span class="fl">0.7</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 5. Create output directory</span></span>
<span><span class="va">output_dir</span> <span class="op">&lt;-</span> <span class="st">"results/figures"</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/files2.html" class="external-link">dir.exists</a></span><span class="op">(</span><span class="va">output_dir</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/files2.html" class="external-link">dir.create</a></span><span class="op">(</span><span class="va">output_dir</span>, recursive <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Create a heatmap with gene conservation annotation</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">pheatmap</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Extract estimate matrix</span></span>
<span><span class="va">estimate_matrix</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/extract_hdf5_metric.html">extract_hdf5_metric</a></span><span class="op">(</span> <span class="va">output_file</span>, <span class="st">"Estimate"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create annotation data frame</span></span>
<span><span class="va">gene_type</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">conservation_results</span><span class="op">$</span><span class="va">is_conserved</span>, <span class="st">"Conserved"</span>, <span class="st">"Non-conserved"</span><span class="op">)</span></span>
<span><span class="va">gene_anno</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  Conservation <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">gene_type</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Conserved"</span>, <span class="st">"Non-conserved"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  row.names <span class="op">=</span> <span class="va">conservation_results</span><span class="op">$</span><span class="va">gene</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create heatmap</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/pheatmap/man/pheatmap.html" class="external-link">pheatmap</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">estimate_matrix</span><span class="op">)</span>, </span>
<span>         annotation_row <span class="op">=</span> <span class="va">gene_anno</span>,</span>
<span>         main <span class="op">=</span> <span class="st">"Expression Patterns of Conserved vs Non-conserved Genes"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 7. Print top conserved genes</span></span>
<span><span class="va">top_conserved</span> <span class="op">&lt;-</span> <span class="va">conservation_results</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/order.html" class="external-link">order</a></span><span class="op">(</span><span class="op">-</span><span class="va">conservation_results</span><span class="op">$</span><span class="va">conservation_score</span><span class="op">)</span>, <span class="op">]</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span>, <span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">top_conserved</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"gene"</span>, <span class="st">"conservation_score"</span>, <span class="st">"is_conserved"</span>, <span class="st">"mean_estimate"</span>, <span class="st">"cv"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="advanced-topics">Advanced Topics<a class="anchor" aria-label="anchor" href="#advanced-topics"></a>
</h3>
<p>For more advanced usage, please see the other vignettes:</p>
<ul>
<li><a href="workflow.html">workflow</a></li>
<li><a href="https://scatlas.readthedocs.io/en/latest/trajectory/20250330_statistical_trajconserve.html" class="external-link">Statistical
background</a></li>
<li><a href="conservation_analysis.html">Conservation analysis in
depth</a></li>
</ul>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Gilbert Han.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
